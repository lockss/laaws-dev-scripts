#!/bin/sh

# This script is used to bootstrap a LOCKSS 2.0 development environment.
# LOCKSS SNAPSHOT artifacts are stored in the Sonatype OSSRH Snapshots
# repository, which maven doesn't search by default.  That repository is
# added by lockss-parent-pom, but maven doesn't know where to find the
# SNAPSHOT version of lockss-parent-pom until it's installed.  This script
# installs the SNAPSHOT version of lockss-parent-pom by building it locally.

bootstrap_one() {
  local git_repo="$1"
  local subdir="${2:-.}"
  local proj_root="${git_repo}"
  if [[ -n "$2" ]]; then
    proj_root="${git_repo}/$2"
  fi
  ( cd /tmp && git clone "https://github.com/lockss/${git_repo}" && cd "${git_repo}" && git checkout develop && cd "${subdir}" && mvn install ) && rm -rf "/tmp/${git_repo}"
}

bootstrap_one lockss-parent-pom
bootstrap_one lockss-pom-bundles lockss-plugins-parent-pom
bootstrap_one lockss-plugins-archetype
